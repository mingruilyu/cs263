<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Sign up</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"type="text/javascript" ></script>
</head>
<body>
	<a href = "/login.jsp">Go back to login!</a><br>
	<font id = 'warning' color = 'red'></font>
	<form action = "/signupprocessor" method = "post" id = "info"></form>
		<table>		
			<tr>
				<td>username</td>
				<td><input type = "text" name = "username" form = "info"/></td>
			</tr>
			<tr>
				<td>password</td>
				<td><input type = "password" name = "password" form = "info"/></td>
			</tr>
			<tr>
				<td>email</td>
				<td><input type = "email" name = "email" form = "info"/></td>
			</tr>
			<tr>
				<td>gender</td>
				<td>
					<select name = "gender" form = "info">
						<option value = "male">male</option>
						<option value = "female">female</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>birthdate(MM/DD/YYYY)</td>
				<td><input type = "date" name = "birthdate" form = "info"/></td>
			</tr>
			<tr>
				<td><button id = "submitbutton">submit</button></td>
			</tr>
		</table>
		<script type="text/javascript">
		$(document).ready(submitEvent);
		function submitEvent() {
			$("#submitbutton").click(submitRequest);
		}
		function submitRequest() {
			var userform = document.getElementById("info");
			
			var userObj = {
				username : userform.elements[0].value,
				password : userform.elements[1].value,
				email : userform.elements[2].value,
				gender : userform.elements[3].value,
				birthdate : userform.elements[4].value
			};
			if (userObj.username == "") {
				$("#warning").text("You have to specify a username!");
				return;
			}
			if (userObj.password == "") {
				$("#warning").text("You have to specify a password!");
				return;
			}
			if (userObj.email == "") {
				$("#warning").text("You have to specify a effective email address!");
				return;
			}
			var userJson = JSON.stringify(userObj);
			console.log(userJson);
			// AJAX code to submit form.
			$.ajax({
				type: 'POST',
				url: '/rest/signupprocessor/test',
				data: userJson,
				async: false,
				contentType: 'application/json',
				success: function(result) {
					if (result == "1")  {
						alert("created");
						var url = "/login.jsp";    
						$(location).attr('href',url);
					}
					else {
						alert("User already exist!");
					}
				},
				error: function (response) {
					alert("Request fail!");
				}
			});
		}
		</script>
</body>
</html>